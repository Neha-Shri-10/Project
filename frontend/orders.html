<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Orders | Artisans Bazaar</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background:#f9fafb; margin:0; }
  nav { background:#fff; padding:15px 30px; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
  nav .logo { font-weight:bold; color:#2c7a7b; display:flex; align-items:center; }
  table { width:100%; border-collapse:collapse; margin-top:30px; }
  th, td { padding:12px; border-bottom:1px solid #eee; text-align:center; }
  th { background:#2c7a7b; color:#fff; }
  tr:hover { background:#f1f1f1; }
  .container { max-width:1000px; margin:40px auto; background:#fff; padding:30px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
  .no-orders { text-align:center; margin-top:40px; color:#777; font-size:1.1em; display:none; }
  .back-btn { display:inline-block; margin-top:20px; padding:10px 20px; background:#2c7a7b; color:#fff; text-decoration:none; border-radius:6px; }
  .back-btn:hover { background:#38b2ac; }
</style>
</head>
<body>
<nav>
  <div class="logo">Artisans Bazaar</div>
  <a href="home.html">üè† Home</a>
</nav>

<div class="container">
  <h2>My Orders</h2>
  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Product</th>
        <th>Price (‚Çπ)</th>
        <th>Quantity</th>
        <th>Status</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="ordersBody"></tbody>
  </table>
  <p class="no-orders" id="noOrders">You have no orders yet.</p>
  <div style="text-align:center;"><a href="home.html" class="back-btn">‚Üê Back to Home</a></div>
</div>

<script>
const user = JSON.parse(localStorage.getItem('user'));

// Redirect if not logged in
if (!user) {
  alert("Please log in to view your orders.");
  window.location.href = "login.html";
} else {
  fetch(`http://localhost:3000/orders/${user.id}`)
    .then(res => {
      if (!res.ok) throw new Error('Network response was not ok');
      return res.json();
    })
    .then(data => {
      const tbody = document.getElementById('ordersBody');
      const noOrders = document.getElementById('noOrders');

      if (!data.orders || data.orders.length === 0) {
        noOrders.style.display = 'block';
        return;
      }

      data.orders.forEach(order => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${order.id}</td>
          <td>${order.product_name}</td>
          <td>${order.price}</td>
          <td>${order.quantity}</td>
          <td>${order.status}</td>
          <td>${new Date(order.order_date).toLocaleString()}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => {
      console.error('Error loading orders:', err);
      alert("Error loading orders. Make sure backend is running on http://localhost:3000 and user is logged in.");
    });
}
</script>
</body>
</html>
